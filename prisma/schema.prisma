// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -----------------
//       ENUMS
// -----------------

enum UserRole {
  manager
  appraiser
}

enum PropertyType {
  singleFamily
  singleFamilyFHA
  multiFamily
  multiFamilyFHA
  condo
  coOp
}

enum PaymentType {
  full
  partial
}

enum PaymentStatus {
  unpaid
  paid
  partial
}

enum OrderStatus {
  open
  closed
  cancelled
}

enum AppraisalType {
  purchase
  refinance
}

// ------------------
//       TABLES
// ------------------

model User {
  id                 String         @id @default(uuid())
  accountId          String         @unique
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  createdBy          String?
  updatedBy          String?
  firstName          String
  lastName           String
  email              String?
  phone              String?
  avatar             String?
  userRole           UserRole[]
  organizations      Organization[] @relation("OrganizationMembers")
  ownedOrganizations Organization[] @relation("OrganizationOwner")
  appraiser          Appraiser?
}

model Organization {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  name      String
  avatar    String?
  members   User[]   @relation("OrganizationMembers")
  owner     User     @relation("OrganizationOwner", fields: [ownerId], references: [id])
  ownerId   String
}

model Appraiser {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?
  firstName   String
  lastName    String
  email       String?
  phone       String?
  orders      Order[]
  userProfile User     @relation(fields: [userId], references: [id])
  userId      String   @unique
}

model Client {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  name      String?
  phone     String?
  email     String?
  street    String?
  street2   String?
  city      String?
  state     String?
  zip       String?
  website   String?
  logo      String?
  poc       String? // point of contact
  note      String?
  favorite  Boolean? @default(false)
  Order     Order[]
}

model Borrower {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  firstName String?
  lastName  String?
  phone     String?
  email     String?
  street    String?
  street2   String?
  city      String?
  state     String?
  zip       String?
  note      String?
  Order     Order[]
}

model Property {
  id           String       @id @default(uuid())
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  createdBy    String?
  updatedBy    String?
  propertyType PropertyType
  street       String?
  street2      String?
  city         String?
  state        String?
  zip          String?
  note         String?
  Order        Order[]
}

model Order {
  id               String         @id @default(uuid())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  createdBy        String?
  updatedBy        String?
  fileNumber       String?
  clientOrderNum   String?
  orderDate        DateTime?
  inspectionDate   DateTime?
  dueDate          DateTime?
  borrower         Borrower?      @relation(fields: [borrowerId], references: [id])
  borrowerId       String?
  property         Property?      @relation(fields: [propertyId], references: [id])
  propertyId       String?
  client           Client?        @relation(fields: [clientId], references: [id])
  clientId         String?
  appraiser        Appraiser?     @relation(fields: [appraiserId], references: [id])
  appraiserId      String?
  orderStatus      OrderStatus?
  appraisalType    AppraisalType?
  paymentStatus    PaymentStatus?
  baseFee          Int?
  techFee          Int?
  questionnaireFee Int?
  contract         Boolean?
  questionnaire    Boolean?
  sent             Boolean?
  Payment          Payment[]
}

model Payment {
  id          String       @id @default(uuid())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  createdBy   String?
  updatedBy   String?
  order       Order        @relation(fields: [orderId], references: [id])
  orderId     String
  amount      Int
  paymentDate DateTime?
  paymentType PaymentType?
  description String?
}
